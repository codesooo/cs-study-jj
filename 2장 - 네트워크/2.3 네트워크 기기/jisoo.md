<br>

> 네트워크는 여러 개의 네트워크 기기를 기반으로 구축된다.
<br>

## 2.3.1 네트워크 기기의 처리 범위
- 계층별로 처리 범위를 나눌 수 있다.
  - 물리 계층을 처리할 수 있는 기기, 데이터 링크 계층을 처리할 수 있는 기기
  - 상위 계층 처리 기기 : 하위 계층 처리 가능
  - 하위 계층 처리 기기 : 상위 계층 처리 불가능
    - L7 스위치는 애플리케이션 계층을 처리하는 기기이므로 그 밑의 모든 계층의 프로토콜을 처리 가능
    - AP는 물리 계층을 처리하는 기기이므로 물리 계층 외에 다른 계층은 처리 불가능
    
|계층|기기|
|:--|:--:|
|애플리케이션 계층|L7 스위치|
|인터넷 계층|라우터, L3 스위치|
|데이터 링크 계층|L2 스위치, 브리지|
|물리 계층|NIC, 리피터, AP|

<br>

## 2.3.2 애플리케이션 계층을 처리하는 기기

### L7 스위치
**`스위치`** 
- 여러 장비 연결
- 데이터 통신 중재
- 목적지가 연결된 포트로만 전기 신호를 보내 데이터를 전송하는 `통신 네트워크 장비`
  
**`L7 스위치`**
- **`로드밸런서`** 라고도 하며, **server의 부하를 분산**하는 기기
- Client로부터 오는 요청들을 여러 server로 나누는 역할을 함
- 목표 : 시스템이 처리할 수 있는 트래픽 증가

#### L4 스위치 vs. L7 스위치
L7 스위치 뿐만 아니라 L4 스위치도 로드밸런서이다. 

|구분|L4 스위치|L7 스위치|
|---|---|---|
|처리 계층|전송 계층|애츨리케이션 계층|
|트래픽 분산 방법|IP, 포트|IP, 포트, URL, HTTP 헤더, 쿠키 등|
|in cloud service|`ALB(Application Load Balancer)` 컴포넌트로 로드밸런싱|`NLB(Network Load Balancer)` 컴포넌트로 로드밸런싱|
||- 스트리밍 관련 서비스에서는 사용 불가 <br>- 메시지 기반 인식 불가능||

#### 헬스 체크
**전송 주기**와 **재전송 횟수** 등을 설정한 이후 **반복적으로** Server에 요청을 보내는 것.
> L4 스위치 or L7 스위치 모두 헬스 체크를 통해 **정상적인 Server** vs. **비정상적인 Server**를 판별한다.

- Server에 부하가 되지 않을 만큼 요청 횟수가 적절해야 함
- TCP, HTTP 등 다양한 방법으로 요청을 보냄
  - 이 요청이 정상적으로 이루어지면 **정상적인 Server**
    - ex) TCP 요청을 보냈는데 -> 3-way handshake가 정상적으로 일어나지 않았다면 -> 정상이 아님!

#### 로드밸런서를 이용한 서버 이중화
**`서버 이중화`**
- 로드밸런서의 대표 기능
  - 2대 이상의 서버를 기반으로 가상 IP를 제공하고 이를 기반으로 안정적인 서비스를 제공
- 서버 A에 장애가 생기 서버 B를 이용하여 서비스를 안정적으로 운용

<p align="center">
<img src="https://github.com/codesooo/cs-study-jj/assets/88030238/8fd4012c-0a0c-4711-a10b-bc7b19bfe6cc" width="40%" height="40%"  >
</p>

user들은 로드밸런서가 제공한 가상 IP인 `0.0.0.12010`에 접근한다. 이는 뒷단의 두 서버, 즉 `0.0.0.12011`과 `0.0.0.12012`를 기반으로 서빙된다. `0.0.0.12011` 서버에 장애가 발생해도 `0.0.0.12012` 서버를 통해 서비스를 안정적으로 운용할 수 있다.

<br>

## 2.3.3 인터넷 계층을 처리하는 기기
인터넷 계층을 처리하는 기기로는 라우터, L3 스위치가 있다. 

### 라우터
- 여러 개의 네트워크를 **연결·분할·구분**시켜주는 역할
- **라우팅**을 하는 장비
  - `라우팅` : 서로 다른 네트워크에 존재하는 장치끼리 서로 데이터를 주고받을 때 패킷 소모를 최소화하고, 경로를 최적화하여 최소 경로로 패킷을 포워딩
- SW 기반의 라우팅, HW 기반의 라우팅으로 나뉨

### L3 스위치
- L2 스위치의 기능과 라우팅 기능을 갖춘 장비
- `L3 스위치 = 라우터`라고 봐도 무방
- HW 기반의 라우팅을 담당

|구분|L2 스위치|L3 스위치|
|--|--|--|
|참조 테이블|MAC 주소 테이블|라우팅 테이블|
|참조 PDU|이더넷 프레임|IP 패킷|
|참조 주소|MAC 주소|IP 주소|

<br>

## 2.3.4 데이터 링크 계층을 처리하는 기기
데이터 링크 계층을 처리하는 기기로는 **L2 스위치**와 **브리지**가 있다.
### L2 스위치
- 장치들의 MAC 주소를 `MAC 주소 테이블`을 통해 관리
- 연결된 장치로부터 패킷이 왔을 때 패킷 전송을 담당
- IP 주소 기반 라우팅은 불가능. (IP 주소를 이해하지 못하기 때문)
- 패킷의 MAC 주소를 읽어 스위칭
- MAC 주소 테이블에 목적지가 없다면 전체 포트에 전달
- MAC 주소 테이블의 주소를 일정 시간 이후 삭제하는 기능이 있음

  
### 브리지 bridge
![image](https://github.com/codesooo/cs-study-jj/assets/88030238/9ba078f0-d793-43d2-a01a-7618d64ca841)
- 두 개의 근거리 통신망(LAN)을 상호 접속할 수 있도록 하는 통신망 연결 장치
- 포트-포트 사이의 다리 역할
- 장치에서 받아온 MAC 주소를 MAC 주소 테이블로 관리
- 통신망 범위를 확장하거나 하나의 통신망을 구축할 때 쓰임

<br>

## 2.3.5 물리 계층을 처리하는 기기
물리 계층을 처리하는 기기는 NIC, 리피터, AP가 있다.

### NIC (Network Interface Card)
- LAN 카드라고 부른다.
- 2대 이상의 컴퓨터 네트워크를 구성하는 데 사용
- 네트워크와 빠른 속도로 데이터를 송수신할 수 있도록 함
- PC 내에 설치하는 확장 카드
- 고유 식별 번호인 MAC 주소를 보유하고 있다. (like 주민등록번호)
  
### 리피터 repeater
![image](https://github.com/codesooo/cs-study-jj/assets/88030238/4fabcfc4-7b65-4590-bd67-e0ed8219b6eb)

[출처](https://velog.io/@minj9_6/%EB%A6%AC%ED%94%BC%ED%84%B0%EC%99%80-%ED%97%88%EB%B8%8C%EC%9D%98-%EA%B5%AC%EC%A1%B0)
- input된 약해진 신호 정도를 증폭하여 다른 쪽으로 output
- 패킷이 더 멀리갈 수 있도록 함
- 광케이블이 보급된 이후로 잘 쓰이지 않고 있음
  

### AP (Access Point)
- 패킷을 복사하는 기기
- AP에 유선 LAN을 연결한 후, 다른 장치에서 무선 LAN 기술(와이파이 등)을 사용하여 무선 네트워크 연결 가능


## 용어 정리

#### 로드밸런싱
부하분산. 네트워크 또는 서버에 가해지는 부하를 분산해주는 기술.

#### 로드밸런서 (LB, Load Balancer)
로드밸런싱 기술을 제공하는 서비스 및 장치


#### 이중화
시스템의 가용성을 높이기 위해 장비를 다중화 시키는 방법

#### 가용성
N개의 서버 장비 중, 하나의 서버 장비에 문제가 생겨도 다른 장비에서 서비스가 될 수 있도록 구현한다. 이를 통해 서비스가 다운되지 않고 정상적으로 유지된 시간이 길어지는 것.

## Reference
- https://devmoony.tistory.com/124

